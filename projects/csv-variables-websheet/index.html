<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'>

<title>Doxtero Websheet</title>

<meta name='description' content='A csv variables websheet for Doxtero'>
<meta name='author' content='Chantero'>
<meta property='og:title' content='Doxtero Websheet'>
<meta property='og:type' content='website'>
<meta property='og:description' content='A csv variables websheet for Doxtero'>


<style>

* {
    box-sizing: border-box;
}

body {
    font-family: Arial, sans-serif;
    padding: 2em;
    background: linear-gradient(90deg, #e3ffe7 0%, #d9e7ff 100%); /* default bg */
    align-items: center;
    justify-content: center;
    text-align: center;
    min-height: 100vh;
}

.default-background {
    background: linear-gradient(90deg, #e3ffe7 0%, #d9e7ff 100%);
}
.copyboard-background {
    background: linear-gradient(17deg, rgba(220,228,109,1) 16%, rgba(244,172,255,1) 100%);
}


h1 {
    color: black;
    margin: 20px;
}


subtitle {
    margin: 1em;
    padding: 1em;
    color: slategray;
}

button {
    cursor: pointer;
    font-size: inherit;
}


/* -- DROP ZONE */
#drop-zone {
    border: 2px dashed #ccc;
    padding: 20px;
    margin: 20px auto;
    min-width: 200px;
    text-align: center;
    color: #ccc;
    background-color: rgba(255, 255, 255, 0.3);
    border-radius: 15px;
}

#drop-zone.drag-over {
    border-color: #1899D6;
    color: #1899D6;
    background-color: rgba(203, 253, 255, 0.3);
}


/* COPYBOARD CHECKBOX */
.checkbox-container {
    font-size: large;
    font-weight: bold;
    display: flex;
    align-items: center;
    text-align: center;
    justify-items: center;
    justify-content: center;
}


.checkbox-container input[type="checkbox"] {
    width: 30px; 
    height: 30px; 
    margin: 30px;
    outline: solid;
}


/* -- COPY INDICATOR */
.copy-indicator {
    text-align: center;
    background-color: rgba(0, 0, 0, 0.7);
    color: white;
    padding: 1em;
    border-radius: 15px;
    position: fixed; /* Position fixed relative to the viewport */
    top: 50%; /* Move down 50% from the top */
    left: 50%; /* Move right 50% from the left */
    transform: translate(-50%, -50%); /* Offset the position to center the element */
    z-index: 9999; /* Ensure it is on top of other elements */
}

.copied-cell {
    background-color: rgba(220, 245, 245, 0.5);
    outline: 2px solid #5BC1D7;
    transition: all 0.1s ease-in-out 0s; 
}



/* TABLE TOOLS */

/* CSS */
#table-tool-toggle-button {
    align-items: center;
    appearance: none;
    background-color: #fff;
    border-radius: 24px;
    border-style: none;
    box-shadow: rgba(99, 99, 99, 0.2) 0px 2px 8px 0px;
    box-sizing: border-box;
    color: #3c4043;
    display: inline-flex;
    fill: currentcolor;
    height: 45px;
    width: 200px;
    justify-content: center;
    line-height: normal;
    padding: 2px 24px;
    text-align: center;
    border: 2px solid #374151;
    transition: box-shadow 280ms cubic-bezier(.4, 0, .2, 1),opacity 15ms linear 30ms,transform 270ms cubic-bezier(0, 0, .2, 1) 0ms;
    user-select: none;
    -webkit-user-select: none;
    touch-action: manipulation;
    will-change: transform,opacity;
    z-index: 0;
    position: -webkit-sticky; /* For Safari */
    position: sticky; /* For modern browsers */
    top: 10px; /* Gap between the top of the viewport and the sticky element */
    z-index: 1000; /* Ensure it stays on top of other content */


}

#table-tool-toggle-button:hover {
  background: #e8f3ff;
  border: 2px solid #70b5f9;
}




#table-tool-container {
    margin-top: 20px;
    margin-bottom: 10px;
    padding: 5px;
    background-color: rgba(176, 224, 230, 0.9);
    min-width: 200px;
    width: 100%;
    border-radius: 16px;
    border: 1px solid #374151;
    box-shadow: rgba(60, 64, 67, 0.3) 0px 1px 2px 0px, rgba(60, 64, 67, 0.15) 0px 1px 3px 1px;

    display: inline-block;
    justify-content: center; /* Center horizontally */
    align-items: center; /* Center vertically */
    position: -webkit-sticky; /* For Safari */
    position: sticky; /* For modern browsers */
    top: 45px; /* Gap between the top of the viewport and the sticky element */
    z-index: 999; /* Ensure it stays on top of other content - except the toggle which is 1000 */
}


/* table tools all buttons class*/
.buttons-container {
    display: flex;
    flex-direction: row; 
    justify-content: center; 
    align-items: center;
    flex-wrap: wrap;
    cursor: auto;
}


#radio-selection {
    display: flex;
    flex-wrap: wrap;        /* Allow wrapping to a new line */
    justify-content: center;
    align-items: center;
    margin: 15px;
    cursor: pointer;
}

#radio-selection > label {
    width: 160px;
    cursor: pointer;
    padding-bottom: 10x;
}


/* Optional: Customize the appearance of the radio buttons */
input[type="radio"] {
    -webkit-appearance: none;  /* Remove default styling */
    -moz-appearance: none;
    appearance: none;
    margin-right: 5px;  /* space between radio and label text */
    border-radius: 50%;
    border: 1.5px solid #555;  
    width: 30px;   
    height: 30px; 
    background-color: white;
    outline: none;
    cursor: pointer;
    vertical-align: middle;
}

input[id="radio-default"]:checked {
    background-color: deepskyblue;  /* Adjust fill color when selected */
}


input[id="radio-select-row"]:checked {
    background-color: yellow;  /* Adjust fill color when selected */
}

input[id="radio-select-column"]:checked {
    background-color: #F472B6;  /* Adjust fill color when selected */
}


#table-tool-tip {
    color: #5a7c87;
    font-style: italic;
    font-size: small;
}

.table-tool-button {
    background-color: #f2f2f2;
    border: 1.5px solid #222222;
    border-radius: 8px;
    box-sizing: border-box;
    color: #222222;
    display: inline-block;
    margin: 5px;
    margin-inline: 15px;
    outline: none;
    padding: 13px 23px;
    position: relative;
    text-align: center;
    text-decoration: none;
    touch-action: manipulation;
    transition: box-shadow .2s,-ms-transform .1s,-webkit-transform .1s,transform .1s;
    width: auto;
}

.table-tool-button:focus-visible {
    box-shadow: #222222 0 0 0 2px, rgba(255, 255, 255, 0.8) 0 0 0 4px;
    transition: box-shadow .2s;
}

.table-tool-button:active {
  background-color: #e5e5e5;
  border-color: #000000;
  transform: scale(.96);
}


.table-tool-button.button-apple {
    background-color: #d7ebce;
}

.table-tool-button.button-apple:active {
    background-color: #bdd7b0;
}

.table-tool-button.button-peach {
    background-color: #FFD3BF;
}

.table-tool-button.button-peach:active {
    background-color: #ffc1a7;
}


.table-tool-button.button-black {
    background-color: #39414d;
    color: white;
}

.table-tool-button.button-black:active {
    background-color: #272c34;
}


.highlight_row {
    background-color: rgba(255, 255, 0, 0.5) !important; 

}

.highlight_column {
    background-color: rgba(255, 212, 234, 0.5) !important; 
}




/* -- TABLE STYLE */

#table-container {
    border-radius: 7px;
    margin-top: 20px;
}


#generated-table {
    margin: 1em;
}


table {
    border-collapse: collapse;
    table-layout: fixed;
    margin: 20px auto;
    padding: 10px;
    background-color: #fff;
    box-shadow: rgba(60, 64, 67, 0.3) 0px 1px 2px 0px, rgba(60, 64, 67, 0.15) 0px 2px 6px 2px;
}

.outer-table {
    padding: 20px;
    background: #fbfffb;
    box-shadow: rgba(60, 64, 67, 0.3) 0px 1px 2px 0px, rgba(60, 64, 67, 0.15) 0px 2px 6px 2px;
}

/* Zebra striping */
tr:nth-of-type(even) { 
    background: #f5f5f5; 
}

th, td {
    padding: 10px;
    text-align: left;
    border: 1px solid #a3a3a3; 
}

th {
    text-align: center;
    background-color: #cff5ff; 
    width: 100px; 
    min-width: 70px; 
    max-width: 100%; /* expand based on content */
}


/* table cell */
table td {
    min-width: 200px;
    max-width: 300px;
    height: 40px;  /* height of cell */
    white-space: normal; /* allow text wrap */
    word-wrap: break-word; /* breaks long words to fit in the cell */
    word-break: break-word; /* ensures long words wrap to the next line */
}


/* the individual selected cell css */
table td:focus {
    background-color: rgba(220, 245, 245, 0.5);
    outline: 2px solid #5BC1D7;
    transition: all 0.1s ease-in-out 0s; 
}

/* Input style for cells */
table input[type="text"] {
    border: none; /* No visible border */
    padding: 0; /* No padding */
    background: none; /* No background */
    box-shadow: none; 
    outline: none; 
    resize: none; /* No resize handle */
    overflow: visible; /* Show overflow text */
    white-space: pre-wrap; /* Allow text to wrap */
    word-wrap: break-word; /* Break long words */
}



.bottom-button {
  padding: 15px;
  width: 135px;
  appearance: button; 
  border: solid transparent;
  border-radius: 16px;
  border-width: 0 0 4px;
  box-sizing: border-box;
  display: inline-block;
  font-size: normal;
  line-height: 20px;
  margin: 10px;
  outline: none;
  overflow: visible;
  padding: 13px 16px;
  text-align: center;
  touch-action: manipulation;
  transform: translateZ(0);
  transition: filter .2s;
  user-select: none;
  -webkit-user-select: none;
  vertical-align: middle;
  white-space: nowrap;
}

.bottom-button:after {
  background-clip: padding-box;
/*  background-color: #1CB0F6;*/
  border: solid transparent;
  border-radius: 16px;
  border-width: 0 0 4px;
  bottom: -4px;
  content: "";
  left: 0;
  position: absolute;
  right: 0;
  top: 0;
  z-index: -1;
}


.bottom-button:active {
  border-width: 4px 0 0;
  background: none;
}


.button-yellow {
    background-color: #e6e18d;
    color: black;
}

.button-yellow:after {
    background-color: #cbfdff;
}


.button-pink {
    background-color: #8e3954;
    color: black;
}

.button-pink:after {
    background-color: #ffa0bd;
}


.button-amber {
    background-color: #a28c42;
    color: black;
}

.button-amber:after {
    background-color: #fdde76;
}


.button-green {
    background-color: #49af81;
    color: black;
}

.button-green:after {
    background-color: #7ae095;
}

.button-blue {
    background-color: #1899D6;
    color: black;
}

.button-blue:after {
    background-color: #68e4ff;
}

.button-purple {
    background-color: #72219c;
    color: black;
}

.button-purple:after {
    background-color: #d3aaea;
}





</style>
</head>


<body onload='setup()'>

<!-- Note: run the setup() [javascript below] when the website loads up -->

<h1>Doxtero Websheet</h1>


<!-- CSV FILE DROP CONTAINER -->
<section id='file-drop-container'>

    <article id='drop-zone'>
        <input type='file' id='csv-input' name='csv-input' accept='.csv' style='display:none'>
        <p>Drop a CSV file here (or) Click to select CSV file</p> 
    </article>

    <subtitle> ─────── 𖥸 ─────── </subtitle>

</section>


<!-- CHECKBOX (Switch between Edit Mode and Copyboard Mode) -->
<section id='checkbox-container'>
    <article class='checkbox-container'>
        <label for='copyboard-checkbox'>Switch to Copyboard</label>
        <input type='checkbox' id='copyboard-checkbox' name='copyboard-checkbox'>
        <div id='copy-indicator';></div>
    </article>

<!--     <subtitle>
        (Note: You have to re-check this box when you load a new csv form)
    </subtitle> -->
</section>



 <!-- Toggle icon for table tools -->
<button id="table-tool-toggle-button" onclick="toggleSection()">&#9660; Hide Table Tools</button>
<br>

<section id='table-tool-container'>

    <form id="radio-selection">
        <label for="radio-default"><input type="radio" name="selection" value="select-default" id="radio-default" checked> Default</label>
        <label for="radio-select-row"><input type="radio" name="selection" id="radio-select-row">Select Row</label>
        <label for="radio-select-column"><input type="radio" name="selection" id="radio-select-column">Select Column</label>
    </form>
    

    <section class='buttons-container'>
        <!-- table tool buttons -->
        <button id="copy-button" class='table-tool-button button-apple'>Copy</button>
        <button id="paste-button" class='table-tool-button button-peach'>Paste</button>

        <button id="clear-button" class='table-tool-button'>Clear Selected</button>
        <button id="delete-button" class='table-tool-button button-black'>Delete Selected</button>
    </section class='buttons-container'>

         <p id='table-tool-tip'>Important note: You should only copy one [Column] at a time</p>
 
        <!-- main buttons -->
    <section class='buttons-container'>
        <button type="button" class="bottom-button button-amber" id="button-new-table">New Table</button>
        
        <button type="button" class="bottom-button button-green" id="button-add-row">Add Row</button>
        <button type="button" class= "bottom-button button-green" id="button-add-column">Add Column</button>
        <button type="button" class="bottom-button button-blue" id="button-export-to-csv">Export CSV</button>
        <button type="button" class="bottom-button button-blue" id="button-export-to-bulk-csv">Bulk CSV</button>
        <button type="button" class="bottom-button button-purple" id="button-export-to-html">Export HTML</button>
    </section>

</section>


<!-- TABLE -->
<section id='table-container' class='outer-table' style='overflow-x:auto;'>
    <!-- Table will be generated automatically via generate_html_table_from_csv() below -->
</section>


<footer>
<br><br><br>
</footer>




<!-- JAVASCRIPT-->
<script>


// main javascript packed in setup()
function setup() {
    // these are just variables to point to the elements in the html


    const drop_zone = document.getElementById('drop-zone');
    const csv_input = document.getElementById('csv-input');
    const table_container = document.getElementById('table-container');

    const copyboard_checkbox = document.getElementById('copyboard-checkbox');
    const copy_indicator = document.getElementById('copy-indicator');

    const button_new_table = document.getElementById('button-new-table');
    const button_add_row = document.getElementById('button-add-row');
    const button_add_column = document.getElementById('button-add-column');
    const button_export_to_csv = document.getElementById('button-export-to-csv');
    const button_export_to_bulk_csv = document.getElementById('button-export-to-bulk-csv');
    const button_export_to_html = document.getElementById('button-export-to-html');


// -- CSV FILE INPUT IN DROP AREA

    // (1) csv input: "click" [#csv-input] when user clicks [#drop-zone]
    drop_zone.addEventListener('click', () => {
        csv_input.click();
    });    // drop area click input close bracket


    // (2) csv input: drag & drop of the csv file to [#drop-zone]
    ['dragover', 'dragleave', 'drop'].forEach(eventName => {
        drop_zone.addEventListener(eventName, (event) => {
            event.preventDefault();
            event.stopPropagation();
            
            if (eventName === 'dragover') {
                drop_zone.classList.add('drag-over');
            } else if (eventName === 'dragleave' || eventName === 'drop') {
                drop_zone.classList.remove('drag-over');
            }

            // Handle file drop
            if (eventName === 'drop') {
                const file = event.dataTransfer.files[0];
                if (file && file.type === 'text/csv') {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        // Efficient DOM update after CSV processing
                        generate_html_table_from_csv(e.target.result);
                    };
                    reader.readAsText(file);
                }
            }
        });
    });    // end - drag & drop file drop area


    // (3) csv input: load csv file and [generate_html_table_from_csv()]
    csv_input.addEventListener('change', (event) => {
        const file = event.target.files[0];
        if (file && file.type === 'text/csv') {
            const reader = new FileReader();
            reader.onload = (e) => {
                const csv_data = e.target.result;
                generate_html_table_from_csv(csv_data);
            };
            reader.readAsText(file)
        }
    });  // end - handle csv file selection


// // PARSE CSV FILE FUNCTION 
    // used in [generate_html_table_from_csv()]
    function parse_csv(csv_text) {

        // normalise quotes from "curly" to "straight" quotes -- is this necessary?
        const normalized_csv_text = csv_text.replace(/‘|’|‛|`|´|‵|′/g, "'")
                                            .replace(/“|”|〝|〞|‶|″|‟/g, '"');
        
        const rows = [];
        let current_row = [];
        let current_field = '';
        let in_quotes = false;

        // Iterate over each character in the normalized CSV text
        for (let i = 0; i < normalized_csv_text.length; i++) {
            const char = normalized_csv_text[i];

            if (char === '"') {
                // Toggle in_quotes or add escaped quotes
                if (in_quotes && normalized_csv_text[i + 1] === '"') {
                    current_field += '"';
                    i++; // Skip the next quote
                } else {
                    in_quotes = !in_quotes;
                }
            } else if (char === ',' && !in_quotes) {
                // Add field to current row
                current_row.push(current_field.trim());
                current_field = '';
            } else if ((char === '\n' || char === '\r') && !in_quotes) {
                // Add row to rows, ensuring not to add empty rows on consecutive newlines
                if (current_field !== '' || current_row.length > 0) {
                    current_row.push(current_field.trim());
                    rows.push(current_row);
                    current_row = [];
                    current_field = '';
                }
            } else {
                current_field += char;
            }
        }

        // Handle last row/field if the file doesn't end with a newline
        if (current_field !== '' || current_row.length > 0) {
            current_row.push(current_field.trim());
            rows.push(current_row);
        }

        return rows;
    }  // end - parse csv


// // GENERATE HTML TABLE FROM CSV FILE
    // this is the main part, to load the csv as html table
    function generate_html_table_from_csv(csv_text) {
        const rows = parse_csv(csv_text);  // parse the csv file -- got "," in the text
        const table = document.createElement('table');
 

        rows.forEach(row => {
            const tr = document.createElement('tr');
            row.forEach(cell => {
                const td = document.createElement('td');

                // insert the contents of the csv to the table
                td.textContent = cell.trim();   
                td.contentEditable = true;  // default content editable

                // [edit mode] vs [locked mode - for copyboard]
                copyboard_checkbox.addEventListener('change', function() {
                    if (this.checked) {
                       // when checkbox is checked - not editable / copyboard on
                        td.contentEditable = false;
                        td.addEventListener('click', copyboard_function);

                    
                    } else {
                        // when checkbox not check - editable / copyboard off
                        td.contentEditable = true;
                        td.removeEventListener('click', copyboard_function);
                    }

                });    // edit mode vs lock mode close bracket

                tr.appendChild(td);
            });
            table.appendChild(tr);


            // Insert the Table Tools here:
                // select and highlight rows and columns
            table.addEventListener('click', table_row_click);
            table.addEventListener('click', table_column_click);


            // set table's id
            table.id = 'generated-table';



        });
        table_container.innerHTML = '';
        table_container.appendChild(table);
 


    }    // end - generate html table from csv



//  COPYBOARD - used in generate html table from csv
    function copy_to_clipboard(text) {
        const temporary_input = document.createElement('input');
        document.body.appendChild(temporary_input);
        temporary_input.value = text;
        temporary_input.select();
        document.execCommand('copy');
        document.body.removeChild(temporary_input);
    } // end - copy to clipboard

    // Function to show copy indicator
    function show_copy_indicator(copied_text) {
        const indicator = document.createElement('div');
        indicator.textContent = `copied: ${copied_text}`;
        indicator.className = 'copy-indicator'
        document.body.appendChild(indicator);
        // Auto-hide the indicator after 0.5 seconds
        setTimeout(() => {
            document.body.removeChild(indicator);
        }, 600);
    } // end - copy indicator



    // Final Combined Copyboard Function
        // using the above: copy_to_clipboard(), show_copy_indicator()
    function copyboard_function(event) {
        const td = event.target;
        const copied_text = td.textContent;
        copy_to_clipboard(copied_text);
        show_copy_indicator(copied_text);

        // change colour of the cell to .copied-cell class
        td.classList.add('copied-cell');
        // remove the colour class automatically after a delay
        setTimeout(() => {
            td.classList.remove('copied-cell');
        }, 500);

    }; // end - copyboard function



    copyboard_checkbox.addEventListener('change', function() {
        if (this.checked) {
            document.body.classList.add('copyboard-background');
            document.body.classList.remove('default-background');
        }
        else {
            document.body.classList.add('default-background');
            document.body.classList.remove('copyboard-background');
        }
    }); // end - change copyboard background color




// BUTTONS

    // (1) Button - Generate New Table
    const new_table_text = "{{variable}},";
    button_new_table.addEventListener('click', function() {
        generate_html_table_from_csv(new_table_text);
    });   // end - new table

    // (2) Button Add Row
    function add_row() {
        const table = document.querySelector('#table-container table');
        if (table) {
            const new_row = table.insertRow();
            for (let i = 0; i < table.rows[0].cells.length; i++) {
                const new_cell = new_row.insertCell();
                new_cell.contentEditable = true;
                
                copyboard_checkbox.addEventListener('change', function() {
                    if (this.checked) {
                        // when checkbox is checked - not editable / copyboard on
                        new_cell.contentEditable = false;
                        new_cell.addEventListener('click', copyboard_function);
                    } else {
                        // when checkbox not checked - editable / copyboard off
                        new_cell.contentEditable = true;
                        new_cell.removeEventListener('click', copyboard_function);
                    }
                });
            }
        }
    }
    button_add_row.addEventListener('click', function() {
        add_row();
    }); // end - add row

    // (3) Button Add Column
    function add_column() {
        const table = document.querySelector('#table-container table');
        if (table) {
            // Iterate through each row and add a new cell
            for (let row of table.rows) {
                const new_cell = row.insertCell();
                new_cell.contentEditable = true;

                copyboard_checkbox.addEventListener('change', function() {
                    if (this.checked) {
                        // when checkbox is checked - not editable / copyboard on
                        new_cell.contentEditable = false;
                        new_cell.addEventListener('click', copyboard_function);
                    } else {
                        // when checkbox not checked - editable / copyboard off
                        new_cell.contentEditable = true;
                        new_cell.removeEventListener('click', copyboard_function);
                    }
                });
            }
        }
    }
    button_add_column.addEventListener('click', function() {
        add_column();
    }); // end - add column


    // (4) Export to CSV

    function export_to_csv(filename) {
        const rows = document.querySelectorAll('#table-container table tr');
        let csvContent = '';

        rows.forEach(row => {
            const cells = row.querySelectorAll('td');
            const rowArray = [];
            cells.forEach(cell => {
                let cellText = cell.textContent.replace(/"/g, '""'); // Escape double quotes
                if (cellText.includes(',') || cellText.includes('\n') || cellText.includes('"')) {
                    cellText = `"${cellText}"`; // Wrap in quotes
                }
                rowArray.push(cellText);
            });
            csvContent += rowArray.join(',') + '\n';
        });

        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = filename;
        link.click();
    };

    // --- export variables.csv
    button_export_to_csv.addEventListener('click', function() {
        export_to_csv('variables.csv');
    }); 

    // --- export variables_bulk.csv
    button_export_to_bulk_csv.addEventListener('click', function() {
            export_to_csv('variables_bulk.csv');
    }); 
    //---- end - export to csv


    // (5) Export HTML

    function export_to_html(filename) {
      // Get all input elements in the table
      var inputs = document.querySelectorAll('input[type="text"]');

      // Update the value attribute of text input elements with the user's input
      inputs.forEach(function(input) {
        input.setAttribute('value', input.value);
      });

      // Export the HTML with updated values
      var htmlContent = document.documentElement.outerHTML;
      var encodedHTML = encodeURIComponent(htmlContent);
      var link = document.createElement('a');
      link.setAttribute('href', 'data:text/html;charset=utf-8,' + encodedHTML);
      link.setAttribute('download', filename);
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    };

     button_export_to_html.addEventListener('click', function() {
            export_to_html('websheet.html');
    });    // end - export to html


}   // setup() close bracket





//  TABLE TOOLS

// Toggle the table tool show/hide
// Function to toggle the section visibility
function toggleSection() {
    var section = document.getElementById('table-tool-container');
    var icon = document.getElementById('table-tool-toggle-button');
    if (section.style.display === "none") {
        section.style.display = "block";
        icon.innerHTML = "&#9660; Hide Table Tools"; // Change icon and text
    } else {
        section.style.display = "none";
        icon.innerHTML = "&#9654; Show Table Tools"; // Change icon and text
    }
}



let highlighted_row = null;
let highlighted_column = null;
let highlighted_rows = new Set();
let highlighted_columns = new Set();

// Function to handle row click
function table_row_click(event) {
    const clicked_cell = event.target.closest('td');
    
    if (clicked_cell) {
        const row = clicked_cell.closest('tr');
        
        if (document.querySelector('#radio-select-row').checked) {
            if (highlighted_rows.has(row)) {
                row.classList.remove('highlight_row');
                highlighted_rows.delete(row);
            } else {
                row.classList.add('highlight_row');
                highlighted_rows.add(row);
            }
            
            // Clear column highlight when switching to multi-select row
            clear_column_highlight();
        }
    }
}

// Function to handle column click
function table_column_click(event) {
    const clicked_cell = event.target.closest('td');
    
    if (clicked_cell) {
        const column_index = Array.from(clicked_cell.parentElement.children).indexOf(clicked_cell);
        const table = document.querySelector('#table-container table');
        const rows = table.querySelectorAll('tr');
        
        if (document.querySelector('#radio-select-column').checked) {
            if (highlighted_columns.has(column_index)) {
                rows.forEach(row => {
                    const cells = row.querySelectorAll('td');
                    if (cells[column_index]) {
                        cells[column_index].classList.remove('highlight_column');
                    }
                });
                highlighted_columns.delete(column_index);
            } else {
                rows.forEach(row => {
                    const cells = row.querySelectorAll('td');
                    if (cells[column_index]) {
                        cells[column_index].classList.add('highlight_column');
                    }
                });
                highlighted_columns.add(column_index);
            }
        }
    }
}

// Function to clear row highlight
function clear_row_highlight() {
    if (highlighted_row) {
        highlighted_row.classList.remove('highlight_row');
        highlighted_row = null;
    }
    highlighted_rows.forEach(row => row.classList.remove('highlight_row'));
    highlighted_rows.clear();
}

// Function to clear column highlight
function clear_column_highlight() {
    if (highlighted_column !== null) {
        const table = document.querySelector('#table-container table');
        if (table) {
            const rows = table.querySelectorAll('tr');
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                if (cells[highlighted_column]) {
                    cells[highlighted_column].classList.remove('highlight_column');
                }
            });
        }
        highlighted_column = null;
    }
    highlighted_columns.forEach(colIndex => {
        const table = document.querySelector('#table-container table');
        if (table) {
            const rows = table.querySelectorAll('tr');
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                if (cells[colIndex]) {
                    cells[colIndex].classList.remove('highlight_column');
                }
            });
        }
    });
    highlighted_columns.clear();
}

// LINK Row and Column Selection TO RADIO BUTTONS
// Function to handle table clicks based on selected radio button
function handle_table_click(event) {
    if (document.querySelector('#radio-select-row').checked) {
        table_row_click(event);
    } else if (document.querySelector('#radio-select-column').checked) {
        table_column_click(event);
    }
}

// Attach event listener to the table and radio buttons
const table = document.querySelector('#table-container table');
if (table) {
    table.addEventListener('click', handle_table_click);
}

// Attach event listener to radio buttons to reset highlights
document.querySelectorAll('input[name="selection"]').forEach(radio => {
    radio.addEventListener('change', () => {
        clear_row_highlight();
        clear_column_highlight();
        update_delete_button_text();
        update_clear_button_text();
        update_copy_button_text();
        update_paste_button_text();
    });
});

// DELETE ROW or COLUMN

// Function to delete selected row or column
function delete_selected() {
    const table = document.querySelector('#table-container table');
    
    if (table) {
        if (highlighted_row) {
            highlighted_row.remove();
            clear_row_highlight();
            clear_column_highlight();
        } else if (highlighted_column !== null) {
            const rows = table.querySelectorAll('tr');
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                if (cells[highlighted_column]) {
                    cells[highlighted_column].remove();
                }
            });
            clear_column_highlight();
        } else if (highlighted_rows.size > 0) {
            highlighted_rows.forEach(row => row.remove());
            clear_row_highlight();
            clear_column_highlight();
        } else if (highlighted_columns.size > 0) {
            const rows = table.querySelectorAll('tr');
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                highlighted_columns.forEach(colIndex => {
                    if (cells[colIndex]) {
                        cells[colIndex].remove();
                    }
                });
            });
            clear_column_highlight();
        }
        update_delete_button_text();  // Update button text after deletion
    }
}

// Function to update the text of the delete button
function update_delete_button_text() {
    const delete_button = document.getElementById('delete-button');
    if (document.querySelector('#radio-select-row').checked) {
        delete_button.textContent = 'Delete Rows';
    } else if (document.querySelector('#radio-select-column').checked) {
        delete_button.textContent = 'Delete Columns';
    } else {
       delete_button.textContent = 'Nothing Selected';
    }
}

// Function to clear selected row or column
function clear_selected() {
    const table = document.querySelector('#table-container table');
    
    if (table) {
        if (highlighted_row) {
            highlighted_row.querySelectorAll('td').forEach(cell => cell.textContent = '');
            clear_row_highlight();
            clear_column_highlight();
        } else if (highlighted_column !== null) {
            const rows = table.querySelectorAll('tr');
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                if (cells[highlighted_column]) {
                    cells[highlighted_column].textContent = '';
                }
            });
            clear_column_highlight();
        } else if (highlighted_rows.size > 0) {
            highlighted_rows.forEach(row => row.querySelectorAll('td').forEach(cell => cell.textContent = ''));
            clear_row_highlight();
            clear_column_highlight();
        } else if (highlighted_columns.size > 0) {
            const rows = table.querySelectorAll('tr');
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                highlighted_columns.forEach(colIndex => {
                    if (cells[colIndex]) {
                        cells[colIndex].textContent = '';
                    }
                });
            });
            clear_column_highlight();
        }
        update_clear_button_text();  // Update button text after clearing
    }
}

// Function to update the text of the clear button
function update_clear_button_text() {
    const clear_button = document.getElementById('clear-button');
    if (document.querySelector('#radio-select-row').checked) {
        clear_button.textContent = 'Clear Rows';
    } else if (document.querySelector('#radio-select-column').checked) {
        clear_button.textContent = 'Clear Columns';
    } else {
       clear_button.textContent = 'Nothing Selected';
    }
}


//  COPY and PASTE

let copied_data = []; // Variable to store copied data

// Function to copy selected row or column data
function copy_selected() {
    const table = document.querySelector('#table-container table');
    copied_data = [];
    const rows = table.querySelectorAll('tr');
    let copied_message = ''; // Variable to hold the copy message

    if (table) {
        if (highlighted_row) {
            // Copy data from a single highlighted row
            const cells = highlighted_row.querySelectorAll('td');
            cells.forEach(cell => copied_data.push(cell.textContent));
            copied_message = 'Copied 1 row';
        } else if (highlighted_column !== null) {
            // Copy data from a single highlighted column
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                if (cells[highlighted_column]) {
                    copied_data.push(cells[highlighted_column].textContent || ''); // Handle blank values
                }
            });
            copied_message = 'Copied 1 column';
        } else if (highlighted_rows.size > 0) {
            // Copy data from multiple highlighted rows
            highlighted_rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                cells.forEach(cell => copied_data.push(cell.textContent || '')); // Handle blank values
            });
            copied_message = `Copied ${highlighted_rows.size} rows`;
        } else if (highlighted_columns.size > 0) {
            // Copy data from multiple highlighted columns
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                highlighted_columns.forEach(colIndex => {
                    if (cells[colIndex]) {
                        copied_data.push(cells[colIndex].textContent || ''); // Handle blank values
                    }
                });
            });
            copied_message = `Copied ${highlighted_columns.size} columns`;
        }
    }

    // Display the copy message if any data was copied
    if (copied_message) {
        select_row_column_copy_indicator(copied_message);
    }
    // ---->>> TO CONFIRM
    update_copy_button_text()
}


// Function to show the copy indicator message
function select_row_column_copy_indicator(message) {
    const indicator = document.createElement('div');
    indicator.textContent = message;
    indicator.style.position = 'fixed';
    indicator.style.top = '50%';
    indicator.style.left = '50%';
    indicator.style.transform = 'translate(-50%, -50%)';
    indicator.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';
    indicator.style.color = 'white';
    indicator.style.padding = '10px 20px';
    indicator.style.borderRadius = '5px';
    indicator.style.zIndex = '1000';
    document.body.appendChild(indicator);

    // Remove the indicator after 1 second
    setTimeout(() => {
        document.body.removeChild(indicator);
    }, 1000);
}




// Function to update the text of the copy button
function update_copy_button_text() {
    const copy_button = document.getElementById('copy-button');
    if (document.querySelector('#radio-select-row').checked) {
        copy_button.textContent = 'Copy Rows';
    } else if (document.querySelector('#radio-select-column').checked) {
        copy_button.textContent = 'Copy Columns';
    } else {
        copy_button.textContent = 'Nothing Selected';
    }
}



// Function to paste data into the selected rows or columns, handling multiple selections
function paste_selected() {
    const table = document.querySelector('#table-container table');
    
    if (table && copied_data.length > 0) {
        const rows = table.querySelectorAll('tr');
        // const numRows = rows.length;
        let data_index = 0;

        if (highlighted_rows.size > 0) {
            // Paste data into multiple rows
            const selected_rows = Array.from(highlighted_rows);
            selected_rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                cells.forEach((cell, cellIndex) => {
                    if (data_index < copied_data.length) {
                        cell.textContent = copied_data[data_index++] || ''; // Handle blank values
                    }
                });
                if (data_index >= copied_data.length) {
                    data_index = 0; // Restart if needed
                }
            });
        } else if (highlighted_columns.size > 0) {
            // Paste data into multiple columns
            const selected_columns = Array.from(highlighted_columns);
            selected_columns.forEach((colIndex) => {
                rows.forEach(row => {
                    const cells = row.querySelectorAll('td');
                    if (cells[colIndex] && data_index < copied_data.length) {
                        cells[colIndex].textContent = copied_data[data_index++] || ''; // Handle blank values
                    }
                });
                if (data_index >= copied_data.length) {
                    data_index = 0; // Restart if needed
                }
            });
        
        }
        update_paste_button_text() 
    }
}



// Function to update the text of the paste button
function update_paste_button_text() {
    const paste_button = document.getElementById('paste-button');
    if (document.querySelector('#radio-select-row').checked) {
        paste_button.textContent = 'Paste Rows';
    } else if (document.querySelector('#radio-select-column').checked) {
        paste_button.textContent = 'Paste Columns';
    } else {
        paste_button.textContent = 'Nothing Selected';
    }
}



// Attach event listener to the delete, clear, copy and paste button
document.getElementById('delete-button').addEventListener('click', delete_selected);
document.getElementById('clear-button').addEventListener('click', clear_selected);
document.getElementById('copy-button').addEventListener('click', copy_selected);
document.getElementById('paste-button').addEventListener('click', paste_selected);


// Initial update of the button text
update_delete_button_text();
update_clear_button_text();
update_copy_button_text();
update_paste_button_text();









</script>
</body>
</html>