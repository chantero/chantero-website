<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Variables: Parties</title>
<link rel="stylesheet" href="../../assets/styles/style.css">
</head>
<body>
<div class="container">

<h1>Variables - Parties</h1>

<div id="blocks_container"></div>

<div style="text-align:center; margin-top: 1em;">
    <button onclick="addVariableBlock()">Add Variable Block</button>
</div>

<script>
const pastelColors = ['#F9D3C5', '#FFEBA1', '#D2E0FE', '#C3E7CA'];
const labels = {
  // details: "Details (Name & IC) - eg: Sherlock Holmes (NRIC No. 123456-12-1234)",
  name: "Name", 
  id: "Identity Number", 
  address: "Address",
  "address registered": "Registered Address", 
  "address business": "Business Address"
};
const modeData = {
  methods: {
    // details: ['name upper', 'name caps', 'ic', 'ic bracket', 'ic number only', 'name ic', 'name ic vertical', 'name ic vertical bracket'], 
    name: ['upper', 'caps'], 
    id: ['ic digits'],
    address: ['lh', 'lv'], 
    'address registered': ['lh', 'lv'], 
    'address business': ['lh', 'lv'],
  },
  templates: [
    "{{variable name | upper}} ({{variable id}}) of {{variable address | lh}}",
    "{{variable name | upper}}\n{{variable id}}",
    "________________________\n{{variable name | upper}}\n({{variable id}})",
    "{{variable name | upper}}\n({{variable id}})\n{{variable address | lv}}",
    "SIGNED by\n{{variable name | upper}}\n({{variable id}})\nin the presence of:",
    "{{variable name | upper}} ({{variable id}}) a company incorporated in Malaysia and having an address at {{variable address | lh}}",
    "{{variable name | upper}} ({{variable id}}) a company incorporated in Malaysia, and having its registered address at {{variable address registered | lh}} and a place of business at {{variable address business | lh}}",
    "THE COMMON SEAL of\n{{variable name | upper}}\n({{variable id}})\naffixed in the presence of:"
  ]
};

const presets = [
    "* clear *",
    "vendor", 
    "purchaser", 
    "customer",
    "borrower",
    "chargor",
    "assignor",
    "bank",
    "developer",
    "proprietor",
];

function addVariableBlock() {
  const block = document.createElement('section');
  block.className = 'paper';

  const containerColor = pastelColors[Math.floor(Math.random() * pastelColors.length)];
  let isCompany = false;
  let directorCount = 2;

  block.innerHTML = `
    <h2>Variable Name: <input type="text" class="var-name"></h2>
    <div class="preset-list"></div>
    <br>
    <div class="center">
      <button class="companyToggle">Company</button>
      <span class="directorCountWrapper" style="display:none; margin-left: 1em;">
        Number of Directors 
        <input type="number" class="dirCount" min="0" value="2" style="width:120px; text-align:center;font-weight:bold">
      </span>
    </div>
    <br>
    <h2 class="center">Methods</h2>
    <div class="methods"></div><br>
    <div class="directors"></div>
    <h2 class="center">Templates</h2>
    <div class="templates"></div><br>
  `;

  document.getElementById('blocks_container').appendChild(block);

  const varInput = block.querySelector('.var-name');
  const methodsContainer = block.querySelector('.methods');
  const directorsContainer = block.querySelector('.directors');
  const templatesContainer = block.querySelector('.templates');
  const companyToggleBtn = block.querySelector('.companyToggle');
  const directorCountWrapper = block.querySelector('.directorCountWrapper');
  const dirCountInput = block.querySelector('.dirCount');
  const presetListDiv = block.querySelector('.preset-list');

  // Preset list
  presets.forEach(preset => {
    const presetBtn = document.createElement('span');
    presetBtn.className = 'method-list';
    presetBtn.style.cursor = 'pointer';
    presetBtn.style.marginRight = '0.5em';
    presetBtn.textContent = preset;
    presetBtn.onclick = () => {
      if (preset === "* clear *") {
        varInput.value = "";
      } else {
        varInput.value = preset;
      }
      renderMethods();
      if (isCompany) renderDirectors();
      renderTemplates();
    };
    presetListDiv.appendChild(presetBtn);
  });

  companyToggleBtn.onclick = () => {
    isCompany = !isCompany;
    companyToggleBtn.style.opacity = isCompany ? '1' : '0.5';
    directorCountWrapper.style.display = isCompany ? 'inline' : 'none';
    renderMethods();
    if (isCompany) renderDirectors(); else directorsContainer.innerHTML = '';
    renderTemplates();
  };

  dirCountInput.oninput = () => {
    directorCount = parseInt(dirCountInput.value) || 0;
    if (isCompany) renderDirectors();
  };

  function renderMethods() {
    methodsContainer.innerHTML = '';
    const baseName = varInput.value.trim() || 'variable';
    for (const category in modeData.methods) {
      if (!isCompany && (category.includes('registered') || category.includes('business'))) continue;
      const grid = document.createElement('div');
      grid.className = 'output-container';
      grid.style.backgroundColor = containerColor;

      const labelDiv = document.createElement('div');
      labelDiv.className = 'output-label';
      labelDiv.textContent = labels[category] || category;
      grid.appendChild(labelDiv);

      modeData.methods[category].forEach(method => {
        const codeEl = document.createElement('div');
        codeEl.className = 'output-box copy-style';
        codeEl.textContent = `{{${baseName} ${category}${method ? ' | ' + method : ''}}}`;
        codeEl.onclick = () => navigator.clipboard.writeText(codeEl.textContent);
        grid.appendChild(codeEl);
      });
      methodsContainer.appendChild(grid);
    }
  }

  function renderDirectors() {
    directorsContainer.innerHTML = '';
    const baseName = (varInput.value.trim() || 'variable') + ' director';
    for (let i = 1; i <= directorCount; i++) {
      const grid = document.createElement('div');
      grid.className = 'output-container';
      grid.style.backgroundColor = containerColor;

      const labelDiv = document.createElement('div');
      labelDiv.className = 'output-label';
      labelDiv.textContent = `Director ${i}`;
      grid.appendChild(labelDiv);

      [
        `{{${baseName} ${i} name | upper}}`,
        `{{${baseName} ${i} name | caps}}`,
        `{{${baseName} ${i} id}}`,
        `{{${baseName} ${i} address | lh}}`,
        `{{${baseName} ${i} address | lv}}`,
        `{{${baseName} ${i} name | upper}}\n{{${baseName} ${i} id}}`,
        `________________________\n{{${baseName} ${i} name | upper}}\n({{${baseName} ${i} id}})`
      ].forEach(text => {
        const codeEl = document.createElement('div');
        codeEl.className = 'output-box copy-style';
        codeEl.textContent = text;
        codeEl.onclick = () => navigator.clipboard.writeText(text);
        grid.appendChild(codeEl);
      });

      directorsContainer.appendChild(grid);
    }
  }

  function renderTemplates() {
    templatesContainer.innerHTML = '';
    const baseName = varInput.value.trim() || 'variable';

    const grid = document.createElement('div');
    grid.className = 'input-container';
    grid.style.backgroundColor = containerColor;

    const labelDiv = document.createElement('div');
    labelDiv.className = 'output-label';
    labelDiv.textContent = 'Templates';
    grid.appendChild(labelDiv);

    modeData.templates.forEach(template => {
      if (!isCompany && (template.includes('registered') || template.includes('business'))) return;
      const replaced = template.replace(
        /{{variable\s+(\w+)(\s*\|\s*[\w\s]+)?}}/g,
        (_, cat, mods) => `{{${baseName} ${cat}${mods || ''}}}`
      );
      const codeEl = document.createElement('div');
      codeEl.className = 'output-box copy-style';
      codeEl.textContent = replaced;
      codeEl.onclick = () => navigator.clipboard.writeText(replaced);
      grid.appendChild(codeEl);
    });
    templatesContainer.appendChild(grid);
  }

  varInput.oninput = () => {
    renderMethods();
    if (isCompany) renderDirectors();
    renderTemplates();
  };

  renderMethods();
  renderTemplates();
}

addVariableBlock();
</script>

<br><br><br><br><br>
</div>
</body>
</html>
