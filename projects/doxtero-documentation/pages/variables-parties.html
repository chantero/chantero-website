<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Variables: Parties</title>
<link rel="stylesheet" href="../styles/main.css">
</head>
<body>
<div class="container">

<h1>Variables - Parties</h1>

<div class="center">
    <button id="companyToggle" onclick="toggleCompany()">Company</button>
    <span id="directorCountWrapper" style="display:none; margin-left: 1em;">
        Number of Directors: 
        <input type="number" id="dirCountGlobal" min="0" value="2" style="width:100px;">
    </span>
</div>

<div id="blocks_container"></div>

<div style="text-align:center; margin-top: 1em;">
    <button onclick="addVariableBlock()">Add Variable Block</button>
</div>

<script>
const pastelColors = ['#F9D3C5', '#FFEBA1', '#D2E0FE', '#C3E7CA'];
const labels = {
  name: "Name", id: "Identity Number", address: "Address",
  "address registered": "Registered Address", "address business": "Business Address"
};
const modeData = {
  methods: {
    name: ['upper', 'caps'], id: ['ic digits'],
    address: ['lh', 'lv'], 'address registered': ['lh', 'lv'], 'address business': ['lh', 'lv']
  },
  templates: [
    "{{variable name | upper}} ({{variable id}}) of {{variable address | lh}}",
    "{{variable name | upper}}\n{{variable id}}",
    "________________________\n{{variable name | upper}}\n({{variable id}})",
    "{{variable name | upper}}\n({{variable id}})\n{{variable address | lv}}",
    "SIGNED by\n{{variable name | upper}}\n({{variable id}})\nin the presence of:",
    "{{variable name | upper}} ({{variable id}}) a company incorporated in Malaysia and having an address at {{variable address | lh}}",
    "{{variable name | upper}} ({{variable id}}) a company incorporated in Malaysia, and having its registered address at {{variable address registered | lh}} and a place of business at {{variable address business | lh}}",
    "THE COMMON SEAL of\n{{variable name | upper}}\n({{variable id}})\naffixed in the presence of:"
  ]
};

let isCompany = false;

function toggleCompany() {
  isCompany = !isCompany;
  document.getElementById('companyToggle').style.opacity = isCompany ? '1' : '0.5';
  document.getElementById('directorCountWrapper').style.display = isCompany ? 'inline' : 'none';
  document.getElementById('blocks_container').innerHTML = '';
  addVariableBlock();
}

function addVariableBlock() {
  const block = document.createElement('section');
  block.className = 'paper';

  const containerColor = pastelColors[Math.floor(Math.random() * pastelColors.length)];
  let directorCount = parseInt(document.getElementById('dirCountGlobal')?.value) || 2;

  block.innerHTML = `
    <h2>Variable Name: <input type="text" class="var-name"></h2>
    <br>
    <h2 class="center">Methods</h2>
    <div class="methods"></div><br>
    ${isCompany ? `<h2 class="center">Directors</h2><div class="directors"></div><br>` : ''}
    <h2 class="center">Templates</h2>
    <div class="templates"></div><br>
  `;

  document.getElementById('blocks_container').appendChild(block);

  const varInput = block.querySelector('.var-name');
  const methodsContainer = block.querySelector('.methods');
  const directorsContainer = block.querySelector('.directors');
  const templatesContainer = block.querySelector('.templates');

  if (isCompany) {
    document.getElementById('dirCountGlobal').oninput = () => {
      directorCount = parseInt(document.getElementById('dirCountGlobal').value) || 0;
      renderDirectors();
    };
  }

  function renderMethods() {
    methodsContainer.innerHTML = '';
    const baseName = varInput.value.trim() || 'variable';
    for (const category in modeData.methods) {
      if (!isCompany && (category.includes('registered') || category.includes('business'))) continue;
      const grid = document.createElement('div');
      grid.className = 'output-container';
      grid.style.backgroundColor = containerColor;

      const labelDiv = document.createElement('div');
      labelDiv.className = 'output-label';
      labelDiv.textContent = labels[category] || category;
      grid.appendChild(labelDiv);

      modeData.methods[category].forEach(method => {
        grid.appendChild(createBox(`{{${baseName} ${category}${method ? ' | ' + method : ''}}}`));
      });
      methodsContainer.appendChild(grid);
    }
  }

  function renderDirectors() {
    if (!isCompany) return;
    directorsContainer.innerHTML = '';
    const baseName = (varInput.value.trim() || 'variable') + ' director';
    for (let i = 1; i <= directorCount; i++) {
      const grid = document.createElement('div');
      grid.className = 'output-container';
      grid.style.backgroundColor = containerColor;

      const labelDiv = document.createElement('div');
      labelDiv.className = 'output-label';
      labelDiv.textContent = `Director ${i}`;
      grid.appendChild(labelDiv);

      grid.appendChild(createBox(`{{${baseName} ${i} name | upper}}`));
      grid.appendChild(createBox(`{{${baseName} ${i} name | caps}}`));
      grid.appendChild(createBox(`{{${baseName} ${i} id}}`));
      grid.appendChild(createBox(`{{${baseName} ${i} address | lh}}`));
      grid.appendChild(createBox(`{{${baseName} ${i} address | lv}}`));
      grid.appendChild(createBox(`{{${baseName} ${i} name | upper}}\n{{${baseName} ${i} id}}`));
      grid.appendChild(createBox(`________________________\n{{${baseName} ${i} name | upper}}\n({{${baseName} ${i} id}})`));

      directorsContainer.appendChild(grid);
    }
  }

  function renderTemplates() {
    templatesContainer.innerHTML = '';
    const baseName = varInput.value.trim() || 'variable';

    const grid = document.createElement('div');
    grid.className = 'input-container';
    grid.style.backgroundColor = containerColor;

    const labelDiv = document.createElement('div');
    labelDiv.className = 'output-label';
    labelDiv.textContent = 'Templates';
    grid.appendChild(labelDiv);

    modeData.templates.forEach(template => {
      if (!isCompany && (template.includes('registered') || template.includes('business'))) return;
      const replaced = template.replace(
        /{{variable\s+(\w+)(\s*\|\s*[\w\s]+)?}}/g,
        (_, cat, mods) => `{{${baseName} ${cat}${mods || ''}}}`
      );
      grid.appendChild(createBox(replaced));
    });
    templatesContainer.appendChild(grid);
  }

  function createBox(text) {
    const div = document.createElement('div');
    div.className = 'output-box copy-style';
    div.textContent = text;
    div.onclick = () => navigator.clipboard.writeText(text);
    return div;
  }

  varInput.oninput = () => {
    renderMethods();
    if (isCompany) renderDirectors();
    renderTemplates();
  };

  renderMethods();
  if (isCompany) renderDirectors();
  renderTemplates();
}

addVariableBlock();
</script>

<br><br><br><br><br>
</div>
</body>
</html>
